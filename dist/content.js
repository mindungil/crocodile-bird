chrome.runtime.onMessage.addListener((e,n,i)=>{e.type==="TOGGLE_BIRD"?(window.crocodileBirdActive=!1,l(),console.log("악어새 기능 중단")):(window.crocodileBirdActive=!0,chrome.storage.local.get("step",o=>{window.crocodileBirdStep=o.step||1,c()})),e.type==="SET_STEP"&&(window.crocodileBirdStep=e.step,console.log(`${e.step} 단계로 설정`))});function c(){console.log("[Content] content.js loaded");const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),n=[];for(window.crocodileBirdActive=window.crocodileBirdActive||!1,window.crocodileBirdStep=window.crocodileBirdStep||1;e.nextNode();){const o=e.currentNode;o.nodeValue.trim()&&n.push(o),console.log(`text 추출 중: ${o.nodeValue}`)}r();const i=n.map(o=>new Promise(d=>{chrome.runtime.sendMessage({type:"crocodile-bird-clean",text:o.nodeValue},t=>{t!=null&&t.cleaned?(o.nodeValue=t.cleaned,console.log("순화 되었습니다. 순환된 노드: ",o.nodeValue)):console.log("node가 비어있거나 API 응답 없음"),d()})}));Promise.all(i).then(()=>{l(),console.log(`${n.length}건의 순화 완료`)})}function r(){const e=document.createElement("div");e.id="crocodile-bird-overlay";const n=document.createElement("img");n.style.width="32px",n.style.height="32px",n.style.marginRight="8px";const i=[chrome.runtime.getURL("icons/loading1.png"),chrome.runtime.getURL("icons/loading2.png"),chrome.runtime.getURL("icons/loading3.png"),chrome.runtime.getURL("icons/loading4.png"),chrome.runtime.getURL("icons/loading5.png")];let o=0;const d=document.createElement("span");d.textContent="악어새가 페이지를 검사하는 중입니다",Object.assign(e.style,{position:"fixed",top:"10px",right:"10px",background:"#000",color:"#fff",padding:"10px 14px",borderRadius:"8px",display:"flex",alignItems:"center",zIndex:99999});const t=setInterval(()=>{n.src=i[o],o=(o+1)%i.length},400);e.dataset.intervalId=t,e.appendChild(n),e.appendChild(text),document.body.appendChild(e)}function l(){const e=document.getElementById("crocodile-bird-overlay");e&&(parseInt(e.dataset.intervalId),clearInterval(e.dataset.intervalId),e.remove())}
