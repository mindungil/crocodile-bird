function I(){chrome.storage.local.get(["crocodileBirdOn","crocodileBirdStep"],e=>{e.crocodileBirdOn==!0?(console.log("새로운 HTML을 처리합니다."),p()):e.crocodileBirdOn===void 0&&g("crocodileBirdOn",!1),e.crocodileBirdStep===void 0&&(g("crocodileBirdStep",2),sessionStorage.setItem("crocodileBirdStep",2),console.log("기본 단게가 high_level로 설정됩니다."))})}I();chrome.runtime.onMessage.addListener((e,o,r)=>{if(e.type==="TOGGLE_BIRD_OFF"){g("crocodileBirdOn",!1),f(),console.log("악어새 기능 중단"),r({ok:!0});return}else e.type==="SET_STEP"&&(g("crocodileBirdStep",e.step),sessionStorage.setItem("crocodileBirdStep",e.step),console.log(`${e.step} 단계로 설정`));return p(),r({ok:!0}),!0});async function p(){if(console.log("[Content] content.js loaded"),N()){console.log("이 페이지는 안전한 페이지 입니다.");return}chrome.storage.local.get("crocodileBirdStep",n=>{sessionStorage.setItem("crocodileBirdStep",n.crocodileBirdStep)});const e=[],o=await _(e);if(e.length===0){console.log("순화할 단어가 없거나, 저장소에서 복구했습니다.");return}o&&(console.log("오버레이가 시작됩니다. 순화할 node가 존재한다면 실행됨, 고정 시간: 2초"),E()),e.forEach(n=>{n.parentNode&&L(n.parentNode)}),setTimeout(()=>{o&&f(),console.log("전체 오버레이 종료")},2e3);const r=await x(e);await b(e,r),e.forEach(n=>{n.parentNode&&P(n.parentNode)}),console.log("모든 노드 블러 처리 종료")}function T(e,o){const r=new Array(o).fill(""),n=/\[NODE_(\d+)\]\s*([\s\S]*?)(?=\[NODE_\d+\]|\s*$)/g;let c;for(;(c=n.exec(e))!==null;){const t=parseInt(c[1],10),s=c[2].trim();t<o&&(r[t]=s)}return r}async function b(e,o){const r=parseInt(sessionStorage.getItem("crocodileBirdStep"))||2,n=await O(o,r);if(!n){console.log("API 응답이 비어있음");return}const c=T(n,e.length);B(e,c),e.forEach((t,s)=>{c[s]&&(t.nodeValue=w(t.nodeValue,c[s]))}),console.log(`총 ${e.length}건의 순화 완료`)}function E(){console.log("오버레이가 화면에 나타납니다.");const e=document.createElement("div");e.id="crocodile-bird-overlay",Object.assign(e.style,{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",background:"#fff",display:"flex",justifyContent:"center",alignItems:"center",zIndex:2147483647});const o=document.createElement("div");Object.assign(o.style,{display:"relative",flexDirection:"column",alignItems:"center",gap:"16px",fontSize:"20px",color:"#000"});let r=document.createElement("span");r.style.cssText=`
  position: absolute;
  bottom: 2vh;
  left: 50%;
  transform: translateX(-50%);
  background-color: rgba(0, 0, 0, 0.7);
  color: white;
  font-size: 2vw; /* 반응형 텍스트 크기 */
  padding: 1vh 2vw;
  border-radius: 10px;
  opacity: 0;
  transition: opacity 0.5s ease;
  z-index: 9999;
  pointer-events: none;
  font-family: sans-serif;
  white-space: nowrap;      
  overflow: hidden;         
  text-overflow: ellipsis;  
  max-width: 90vw;          
`;const n=document.createElement("img");n.style.width="65vw",n.style.height="45vh",n.style.display="block";const c=[chrome.runtime.getURL("icons/0.png"),chrome.runtime.getURL("icons/1.png"),chrome.runtime.getURL("icons/2.png"),chrome.runtime.getURL("icons/3.png"),chrome.runtime.getURL("icons/4.png"),chrome.runtime.getURL("icons/5.png"),chrome.runtime.getURL("icons/6.png"),chrome.runtime.getURL("icons/7.png")],t=["옛날, 나일강 근처의 밀림에는 무서운 악어 한 마리가 살고 있었습니다.","이 악어는 육지와 강을 오가며 사냥을 즐겼습니다.","악어는 식사 후엔 입 안에 고기 찌꺼기와 이물질이 끼어 항상 불편했습니다.","어느 날, 작은 새 한 마리가 악어가 입을 벌린 채 햇볕을 쬐고 있는 것을 보고 다가왔습니다.","새는 용감하게 악어의 입속으로 들어가 고기 찌꺼기들을 쪼아 먹었습니다.","악어는 새를 해치지 않고 오히려 가만히 있었죠.","그날 이후로, 이 새는 악어의 이빨을 매일 청소해줬습니다.","악어는 새가 안전하게 입 안에서 먹이를 찾을 수 있도록 도와주었습니다.","둘은 서로에게 이득이 되는 관계, 즉 ‘공생 관계’를 맺게 되었습니다.","따라서 사람들은 이 새를 ‘악어새’라고 부르게 되었습니다.","오늘날까지도 “악어와 악어새처럼 서로 돕는 관계”는 협력의 상징으로 종종 비유됩니다."];let s=0,i=0;const a=setInterval(()=>{n.src=c[s],s=(s+1)%c.length},400),m=setInterval(()=>{r.textContent=t[i],r.style.opacity="1",setTimeout(()=>{r.style.opacity="0"},3e3),i=(i+1)%t.length},3500);e.dataset.intervalIdImage=a,e.dataset.intervalIdText=m,o.appendChild(n),o.appendChild(r),e.appendChild(o),document.body.appendChild(e)}function f(){console.log("오버레이가 화면에서 제거되는 중 입니다.");const e=document.getElementById("crocodile-bird-overlay");e&&(clearInterval(parseInt(e.dataset.intervalIdImage)),clearInterval(parseInt(e.dataset.intervalIdText)),e.remove())}function N(){const e=location.hostname,o=location.pathname;if((e+o).includes("www.google.com/search"))return!1;if(e.includes(".google.")||e.includes("google."))return!0;const r=["go.kr","korea.kr",".ac.kr","gouv.fr",".or.kr","gov.uk",".re.kr","who.int","un.org","openai.com","chat.openai.com","github.com","chrome://","notion.so","section.blog.naver.com","chatgpt.com","wikipedia.org","wikimedia.org","archive.org","ietf.org","mdn.mozilla.org","developer.mozilla.org","stackoverflow.com","readthedocs.io","npmjs.com","pypi.org","namu.wiki","outlook.live.com","outlook.office.com","mail.daum.net","mail.yahoo.com","proton.me","icloud.com"],n=["www.facebook.com","www.instagram.com","twitter.com","www.youtube.com","www.linkedin.com","m.cafe.naver.com","blog.kakaocorp.com"],c=["news.daum.net","www.chosun.com","www.joongang.co.kr","www.hani.co.kr"],t=["www.coupang.com","www.amazon.com","www.ebay.com"],s=["fmkorea.com","ruliweb.com","todayhumor.co.kr"],i=["/policy","/static","/notice","/faq","/help","/support","/terms","/privacy","/about","/legal","/copyright","/docs","/document","/manual","/guide","/getting-started","/license","/disclaimer","/robots.txt","/sitemap","/technology","/developers","/ads","/advertisements","/forum","/boards","/comments","/shop","/store","/products","/member","/users","/profile"],a=r.some(l=>e.includes(l)),m=n.some(l=>e.includes(l)),u=c.some(l=>e.includes(l)),y=t.some(l=>e.includes(l)),S=s.some(l=>e.includes(l)),v=i.some(l=>o.includes(l));return!!(a||v||m||u||y||S)}async function O(e,o){return console.log("sendCleanRequest 함수 호출"),new Promise(r=>{chrome.runtime.sendMessage({type:"crocodile-bird-clean",text:e,num:o},n=>{r(n==null?void 0:n.cleaned)})})}function g(e,o){chrome.storage.local.set({[e]:o},()=>{console.log(`${e}가 ${o}로 설정됨`),e=="crocodileBirdStep"&&sessionStorage.getItem("crocodileBirdStep")})}function B(e,o){const r=window.location.href,n=parseInt(sessionStorage.getItem("crocodileBirdStep"))||2,c=h();try{let t=0;e.forEach((s,i)=>{c[s.nodeValue]=o[i],t++}),sessionStorage.setItem(`${r}__${n}`,JSON.stringify(c)),console.log(`세션스토리지에 ${t}개가 성공적으로 저장되었습니다.`)}catch(t){console.log(`세션 스토리지 에러: ${t}`)}}function h(){const e=parseInt(sessionStorage.getItem("crocodileBirdStep"))||2,o=window.location.href,r=sessionStorage.getItem(`${o}__${e}`);return r?JSON.parse(r)||{}:{}}function x(e){return e.map((o,r)=>`[NODE_${r}] ${o.nodeValue.trim()}`).join(`
`)}function C(e){const o=["like","share","recommend","follow","subscribe","vote","save","bookmark","meta","sharing","author","likes","liked","likers","liker"];return e.toLowerCase().split(/[-_.:]/).some(n=>o.includes(n))}async function _(e){const o=location.hostname,r=location.pathname;if(o.includes(".google.")||o.includes("google.")){console.log("google 사이트 입니다.");const c=document.createTreeWalker(document.getElementById("rso"),NodeFilter.SHOW_TEXT);return d(e,c),!1}else if(o.includes(".naver.com")){if(o.includes("search.naver.com")){console.log("naver 검색 엔진 입니다.");const c=document.createTreeWalker(document.querySelector(".lst_total"),NodeFilter.SHOW_TEXT),t=document.createTreeWalker(document.querySelector(".lst_view"),NodeFilter.SHOW_TEXT);return d(e,c),d(e,t),!1}else if(r.includes("/article")){let c=function(s=4e3){return new Promise(i=>{const a=Date.now(),m=setInterval(()=>{const u=document.querySelectorAll(".u_cbox_contents");u.length>0?(clearInterval(m),i(u)):Date.now()-a>s&&(console.log("댓글 요소를 찾지 못했습니다 (4초 타임아웃)"),clearInterval(m),i(null))},500)})};var n=c;console.log("naver 뉴스 댓글 입니다.");const t=await c(3e3);return t&&t.length>0&&t.forEach(s=>{const i=document.createTreeWalker(s,NodeFilter.SHOW_TEXT);d(e,i)}),!1}return!1}else if(o.includes("search.daum.net")){console.log("daum 검색 엔진 입니다."),console.log("다중 treewalker 호출");const c=document.createTreeWalker(document.getElementById("twdColl"),NodeFilter.SHOW_TEXT),t=document.createTreeWalker(document.getElementById("st3Coll"),NodeFilter.SHOW_TEXT);return basicPage=!1,d(e,c),d(e,t),!1}else{console.log("일반 사이트 입니다.");const c=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT);return d(e,c),!0}}function d(e,o){var n,c;const r=h();for(;o.nextNode();){const t=o.currentNode,s=(c=(n=t.parentNode)==null?void 0:n.nodeName)==null?void 0:c.toUpperCase();if(r[t.nodeValue]){t.nodeValue=w(t.nodeValue,r[t.nodeValue]);continue}["SCRIPT","STYLE","TEMPLATE","NOSCRIPT","NAV","FIGCAPTION","HEADER","FOOTER","FORM","INPUT","BUTTON","SELECT","LABEL","OBJECT","PARAM","TIME"].includes(s)||!t.nodeValue||!t.nodeValue.trim()||(()=>{const i=t.parentNode;if(!i)return!1;const a=typeof i.className=="string"?i.className:Array.from(i.classList||[]).join(" ");return C(a)})()||e.push(t)}}function w(e,o){var c,t;const r=((c=e.match(/^\s*/))==null?void 0:c[0])??"",n=((t=e.match(/\s*$/))==null?void 0:t[0])??"";return r+o+n}const k=document.createElement("style");k.textContent=`
    .crocodile-bird-blur {
        filter: blur(10px); /* 더 진한 모자이크 효과를 위해 값 조정 */
        -webkit-filter: blur(10px);
    }
`;document.head.appendChild(k);function L(e){e.classList.add("crocodile-bird-blur")}function P(e){e.classList.remove("crocodile-bird-blur")}
