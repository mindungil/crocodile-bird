chrome.storage.local.get(["crocodileBirdOn"],e=>{if(e.crocodileBirdOn===void 0)chrome.storage.local.set({crocodileBirdOn:!1},()=>{console.log('기본값 crocodileBirdOn: "off" 설정됨')});else if(e.crocodileBirdOn===!1){console.log("악어새 봇이 해제 중 입니다.");return}});chrome.runtime.onMessage.addListener((e,n,i)=>{if(e.type==="TOGGLE_BIRD"){window.crocodileBirdActive=!1,l(),console.log("악어새 기능 중단");return}else e.type==="SET_STEP"&&(window.crocodileBirdStep=e.step,console.log(`${e.step} 단계로 설정`));console.log("악어새 봇이 돌아가는 중 입니다...."),window.crocodileBirdActive=!0,chrome.storage.local.get("step",t=>{window.crocodileBirdStep=t.step||1,r()})});function r(){console.log("[Content] content.js loaded");const e=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT),n=[];for(window.crocodileBirdActive=window.crocodileBirdActive||!1,window.crocodileBirdStep=window.crocodileBirdStep||1;e.nextNode();){const o=e.currentNode;o.nodeValue.trim()&&n.push(o),console.log(`text 추출 중: ${o.nodeValue}`)}a();function i(o){return new Promise(c=>{chrome.runtime.sendMessage({type:"crocodile-bird-clean",text:o},d=>{c((d==null?void 0:d.cleaned)||null)})})}async function t(o){for(const c of o){const d=await i(c.nodeValue);d?(c.nodeValue=d,console.log("순화된 노드:",c.nodeValue)):console.log("node가 비어있거나 API 응답 없음")}l(),console.log(`총 ${o.length}건의 순화 완료`)}t(n)}function a(){const e=document.createElement("div");e.id="crocodile-bird-overlay";const n=document.createElement("img");n.style.width="32px",n.style.height="32px",n.style.marginRight="8px";const i=[chrome.runtime.getURL("icons/loading1.png"),chrome.runtime.getURL("icons/loading2.png"),chrome.runtime.getURL("icons/loading3.png"),chrome.runtime.getURL("icons/loading4.png"),chrome.runtime.getURL("icons/loading5.png")];let t=0;const o=document.createElement("span");o.textContent="악어새가 페이지를 검사하는 중입니다",Object.assign(e.style,{position:"fixed",top:"10px",right:"10px",background:"#000",color:"#fff",padding:"10px 14px",borderRadius:"8px",display:"flex",alignItems:"center",zIndex:99999});const c=setInterval(()=>{n.src=i[t],t=(t+1)%i.length},400);e.dataset.intervalId=c,e.appendChild(n),e.appendChild(text),document.body.appendChild(e)}function l(){const e=document.getElementById("crocodile-bird-overlay");e&&(parseInt(e.dataset.intervalId),clearInterval(e.dataset.intervalId),e.remove())}
